# –ù–∞–∑–≤–∞–Ω–∏–µ workflow, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ GitHub Actions
name: CI/CD Pipeline for Timezone App

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–æ–±—ã—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å–∫–∞—é—Ç —ç—Ç–æ—Ç workflow
on:
  # –ó–∞–ø—É—Å–∫ –ø—Ä–∏ push (–∫–æ–≥–¥–∞ –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
  push:
    branches: [ main ]  # –¢–æ–ª—å–∫–æ –¥–ª—è –≤–µ—Ç–∫–∏ main
  
  # –ó–∞–ø—É—Å–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Pull Request
  pull_request:
    branches: [ main ]  # –¢–æ–ª—å–∫–æ –¥–ª—è PR, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –≤ main

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–∞–¥–∞—á–∏ (jobs), –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è
jobs:
  # –ó–∞–¥–∞—á–∞ 1: –°–±–æ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö
  build-and-test:
    # –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ GitHub
    # ${{ matrix.os }} –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –û–° –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
    name: Build and Test on ${{ matrix.os }}
    
    # –ù–∞ –∫–∞–∫–æ–π –û–° –∑–∞–ø—É—Å–∫–∞—Ç—å –∑–∞–¥–∞—á—É (–±–µ—Ä–µ—Ç—Å—è –∏–∑ –º–∞—Ç—Ä–∏—Ü—ã –Ω–∏–∂–µ)
    runs-on: ${{ matrix.os }}
    
    # –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–∞—Ç—Ä–∏—Ü—ã: –∑–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –û–° –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
    strategy:
      matrix:
        # –°–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        os: [ubuntu-latest, windows-latest, macos-latest, macos-13]
        # –í–µ—Ä—Å–∏—è Node.js –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—É—Å–∫–æ–≤
        node-version: [20.x]
    
    # –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –≤ —ç—Ç–æ–π –∑–∞–¥–∞—á–µ
    steps:
      # –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      - name: Checkout repository
        uses: actions/checkout@v4
      
      # –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º npm –º–æ–¥—É–ª–µ–π
      - name: Setup Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'  # –ö—ç—à–∏—Ä—É–µ—Ç node_modules –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏
      
      # –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–æ–µ–∫—Ç–∞
      # npm ci —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–æ—á–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –∏–∑ package-lock.json
      - name: Install dependencies
        run: npm ci
      
      # –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º ESLint
      - name: Run linter
        run: npm run lint
      
      # –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ —á–µ—Ä–µ–∑ Prettier
      - name: Check code formatting
        run: npm run format:check
      
      # –®–∞–≥ 6: –ó–∞–ø—É—Å–∫ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤ (5 —Ç–µ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ Jest)
      - name: Run tests
        run: npm test
      
      # –®–∞–≥ 7: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤ –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
      # –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —à–∞–≥–∏ –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å
      - name: Upload test results
        uses: actions/upload-artifact@v4
        if: always()  # –í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —à–∞–≥–∞—Ö
        with:
          name: test-results-${{ matrix.os }}  # –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –¥–ª—è –∫–∞–∂–¥–æ–π –û–°
          path: coverage/  # –ü–∞–ø–∫–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ç–µ—Å—Ç–æ–≤
          retention-days: 7  # –•—Ä–∞–Ω–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã 7 –¥–Ω–µ–π

  # –ó–∞–¥–∞—á–∞ 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–∞ Render.com
  deploy:
    # –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –¥–µ–ø–ª–æ—è
    name: Deploy to Render.com
    
    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: —ç—Ç–∞ –∑–∞–¥–∞—á–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è build-and-test
    needs: build-and-test
    
    # –î–µ–ø–ª–æ–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ Ubuntu (–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –Ω–µ –≤–∞–∂–Ω–∞ –¥–ª—è curl –∑–∞–ø—Ä–æ—Å–∞)
    runs-on: ubuntu-latest
    
    # –£—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: —Ç–æ–ª—å–∫–æ –ø—Ä–∏ push –≤ main (–Ω–µ –¥–ª—è pull request)
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    
    steps:
      # –®–∞–≥ 1: –û—Ç–ø—Ä–∞–≤–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ Render Deploy Hook
      # –≠—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–∞ Render.com
      - name: Trigger Render Deploy
        run: |
          curl -X POST "${{ secrets.RENDER_DEPLOY_HOOK }}"
      
      # –®–∞–≥ 2: –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –¥–µ–ø–ª–æ—è
      - name: Deployment status
        run: |
          echo "‚úÖ Deployment triggered successfully"
          echo "üåê Application will be available at Render.com shortly"